<div class = "container">
  <div class = "row">
    <h4>注文確認画面</h4>
    <div class = "col-md-8">
      <div class = "table-responsive-sm">
        <table class = "table text-nowrap table-bordered">
          <thead class = "table-dark">
            <tr>
              <th>商品名</th>
              <th>単価</th>
              <th>数量</th>
              <th>小計</th>
            </tr>
          </thead>
          <% @sum = 0 %>
          <% @cart_items.each do |cart_item| %>
          <tbody>
            <tr>
              <td>
                <%= image_tag cart_item.item.item_image, size: "60x50" %>
                <%= cart_item.item.name %>
              </td>
              <td><%= cart_item.item.add_tax_price.to_s(:delimited) %></td>
              <td><%= cart_item.item_quantity %></td>
              <% subtotal = (cart_item.item.add_tax_price*cart_item.item_quantity).to_i %>
              <% @sum += subtotal %>
              <td><%= @sum.to_s(:delimited) %></td>
            </tr>
          </tbody>
          <% end %>
        </table>
      </div>
    </div>
    <div class = "col-md-4">
      <table class = "table text-nowrap table-bordered">
        <tr>
          <th class = "table-dark">商品合計</th>
          <td><%= @sum.to_s(:delimited) %></td>
        </tr>
        <tr>
          <th class = "table-dark">送料</th>
          <td>800</td>
        </tr>
        <tr>
          <th class = "table-dark">請求金額</th>
          <td><%= (@sum + 800).to_s(:delimited) %></td>
        </tr>
      </table>
    </div>
  </div>

  <div class = "row gy-2">
    <div class = "col-md-2">
      <p>支払い方法</p>
    </div>
    <div class = "col-md-7">
      <%= @order.payment_method_i18n%>
    </div>
    <div class = "offset-md-3"></div>
    <div class = "col-md-2">
      <p>お届け先</p>
    </div>
    <div class = "col-md-7">
      〒<%= @order.postcode %>
      <%= @order.ship_to_address %>
      <%= @order.ship_name %>
    </div>
    <div class = "offset-md-3"></div>
  </div>

  <div class = "row text-center">
    <%= form_with model: @order , url: "/orders" do |f| %>
      <%= f.hidden_field :customer_id, value: current_customer.id %>
      <%= f.hidden_field :payment_method, value:  @order.payment_method %>
      <%= f.hidden_field :freight, value: 800 %>
      <%= f.hidden_field :postcode, value: @order.postcode %>
      <%= f.hidden_field :total_price, value: @sum + 800%>
      <%= f.hidden_field :ship_to_address, value: @order.ship_to_address%>
      <%= f.hidden_field :ship_name, value: @order.ship_name %>
      <%= f.hidden_field :order_status, value: "wait_payment"%>
      <%= f.submit "注文を確定する", class: "btn btn-success" %>
    <% end %>
  </div>

</div>
