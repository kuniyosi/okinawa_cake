<div class = "container">
  <div class = "row mt-5">
    <div class = "col-md-8 mx-auto">
      <% if current_customer.cart_items.present? %>
          <!--カート内に商品がある場合-->
      <div class = "cart_head d-sm-flex">
        <h4 class = "bg-secondary text-light text-nowrap">ショッピングカート</h4>
        <%= link_to "カートを空にする", cart_item_destroy_all_items_path(@cart_items), method: :delete,class: "btn btn-danger ms-auto" %>
      </div>
      <div class = "table-responsive-sm">
      <!--table-responsiveで横スクロールにも対応できる表ができる。sm追加で575.98px以下で横スクロールに切り替え-->
        <table class = "table text-nowrap table-bordered mt-3">
          <thead>
            <tr class = "table-dark">
              <th>商品名</th>
              <th>単価(税込)</th>
              <th>数量</th>
              <th>小計</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
          <% total = 0 %>
          <!--合計金額totalの初期化-->
            <% @cart_items.each do |cart_item| %>
            <tr>
              <td>
                <%= image_tag cart_item.item.item_image, size: "60x50" %>
                <%= cart_item.item.name %>
              </td>
              <td><%= cart_item.item.add_tax_price.to_i %>円</td>
              <td>
                <%= form_with model: cart_item, url: cart_item_path(cart_item), method: :patch do |f| %>
                  <%= f.select :item_quantity, *[1..10] %>
                  <%= f.submit "変更",class: "btn btn-success" %>
                <% end %>
              </td>
              <td>
                <% subtotal = (cart_item.item.add_tax_price*cart_item.item_quantity).to_i %>
                <%= subtotal %>
              </td>
              <td>
                <%= link_to "削除する", cart_item_path(cart_item), method: :delete,class: "btn btn-danger" %>
              </td>
            </tr>
            <% total += subtotal %>
          <% end %>
          </tbody>
        </table>
      </div>
      <div class = "d-md-flex">
        <div class = "btn mb-3">
          <%= link_to "買い物を続ける", items_path, class: "btn btn-primary" %>
        </div>
        <div class = "col-md-4 text-nowrap ms-auto">
        <table class = "table text-nowrap table-bordered">
          <tr>
            <th>合計金額</th>
            <td><%= total %></td>
          </tr>
        </table>
        </div>
      </div>
      <div class = "text-center">
        <%= link_to "情報入力に進む", new_order_path, class: "btn btn-success col-md-4" %>
      </div>
      <% else %>
      <!--カートに商品がない場合-->
      <div class = "text-center">
        <p>カートに商品がありません</p>
        <%= link_to '商品を探す', items_path, class: "btn btn-primary" %>
      </div>
      <% end %>
    </div>
  </div>
</div>
